<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0 user-scalable=no" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300&display=swap" rel="stylesheet" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="stylesheet" href="main.css" />
  <link rel="stylesheet" href="animation.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
  <title>4 Phrases</title>
</head>

<body>
  <main>
    <p id="quote"></p>
    <p id="author" style="display: none"></p>
    <p id="loader">Loading...</p>
  </main>
  <div class="help"></div>
  <footer>
    <p class="next">next</p>
  </footer>

  <script defer>
    (function () {

      const bgColors = [
        { background: "#f4f0ea", color: "#544b43" },
        { background: "#aa5a2e", color: "#f5f3f3" },
        { background: "#dfc7a9", color: "#544b43" },
        { background: "#533320", color: "#d3cfcb" },
        { background: "#373737", color: "#d3cfcb" },
        { background: "#b5a886", color: "#544b43" },
      ];

      const elements = {
        nextButton: document.querySelector(".next"),
        author: document.querySelector("#author"),
        loader: document.querySelector("#loader"),
        quote: document.querySelector("#quote"),
      };

      let quotesArray = [];
      let authorArray = [];
      let currentArrayIndex = 0;

      async function fetchAndHandleQuote() {
        try {
          const response = await fetch("https://quotes-api-self.vercel.app/quote");
          //fetch('https://example.com/resource', { mode: 'no-cors' })
          const data = await response.json();
          addContentToHtml(data);
        } catch (error) {
          elements.loader.textContent =
            "Site can't be reached, check the connection.";
          elements.nextButton.textContent = "Reload";
        };
      };

      function addContentToHtml(data) {
        elements.loader.style.display = "none";
        elements.quote.textContent = data.quote;
        elements.author.textContent = data.author;
        elements.nextButton.style.display = "";
        elements.nextButton.textContent = "next";
        quotesArray.push(data.quote);
        authorArray.push(data.author);
        currentArrayIndex = quotesArray.length - 1;
      };

      function goToPreviousWord() {
        if (currentArrayIndex > 0) {
          elements.quote.textContent =
            quotesArray[--currentArrayIndex];
          elements.author.textContent =
            authorArray[--currentArrayIndex];
        };
      };

      function setRandomBgColor(arr) {
        const randomIndex = Math.floor(Math.random() * arr.length);
        document.body.style.backgroundColor = arr[randomIndex].background;
        document.body.style.color = arr[randomIndex].color;
      };

      function popUpMsg(txt) {
        const popUpMsgEl = document.querySelector(".help");
        popUpMsgEl.textContent = txt;
        setTimeout(() => popUpMsgEl.remove(), 2999);
      };

      let showAuthorValue = false;

      function showAuthorName() {
        elements.author.style
          .display = elements.author.style.display == 'none' ? '' : 'none';
      };

      const hammertime = new Hammer(document.querySelector("body"));

      hammertime.on("swiperight", goToPreviousWord);
      hammertime.on("swipeleft", fetchAndHandleQuote);
      hammertime.on("doubletap", () => setRandomBgColor(bgColors));
      hammertime.on("pandown", () => setRandomBgColor(bgColors));
      hammertime.on("panup", () => setRandomBgColor(bgColors));

      elements.quote
        .addEventListener("click", showAuthorName);

      elements.nextButton
        .addEventListener("click", fetchAndHandleQuote);

      document.addEventListener("DOMContentLoaded", () => {
        setRandomBgColor(bgColors);
        popUpMsg("‹ swipe & tap ›");
        fetchAndHandleQuote();
      });

    })();
  </script>
</body>

</html>
