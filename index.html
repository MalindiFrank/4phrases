<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0 user-scalable=no" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300&display=swap" rel="stylesheet" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="stylesheet" href="main.css" />
  <link rel="stylesheet" href="animation.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
  <title>4 Phrases</title>
</head>

<body>
  <main>
    <p id="quote"></p>
    <p id="author" style="display: none"></p>
    <button id="next" style="display: none">next</button>
    <p id="loader">Loading...</p>
  </main>
  <div class="help"></div>
  <footer>
    <p class="next">next</p>
  </footer>

  <script>
    const bgColors = [
      { background: "#f4f0ea", color: "#544b43" },
      { background: "#aa5a2e", color: "#f5f3f3" },
      { background: "#dfc7a9", color: "#544b43" },
      { background: "#533320", color: "#d3cfcb" },
      { background: "#373737", color: "#d3cfcb" },
      { background: "#b5a886", color: "#544b43" },
    ];

    let quotesArray = [];
    let currentArrayIndex = 0;

    async function fetchAndHandleQuote() {
      try {
        const response = await fetch("https://quotes-api-self.vercel.app/quote");
        const data = await response.json();
        addContentToHtml(data);
      } catch (error) {
        loaderTag.textContent =
          "Site can't be reached, check the connection.";
        nextButton.textContent = "Reload";
        throw error;
      };
    };

    function addContentToHtml(data) {
      loaderTag.style.display = "none";
      qouteTag.textContent = data.quote;
      authorTag.textContent = data.author;
      nextButton.style.display = "";
      nextButton.textContent = "next";
      quotesArray.push(data.quote);
      currentArrayIndex = quotesArray.length - 1;
    };

    function goToPreviousWord() {
      if (currentArrayIndex >= 1) {
        qouteTag.textContent =
          quotesArray[currentArrayIndex - 1];
        currentArrayIndex--;
      };
    };

    function setRandomBgColor(arr) {
      const randomIndex = Math.floor(Math.random() * arr.length);
      document.body.style.backgroundColor = arr[randomIndex].background;
      document.body.style.color = arr[randomIndex].color;
    };

    function popUpMsg(txt) {
      const popUpMsgEl = document.querySelector(".help");
      popUpMsgEl.textContent = txt;
      setTimeout(() => popUpMsgEl.remove(), 2999);
    };

    let showAuthorValue = false;

    function showAuthorName() {
      authorTag.style.display = showAuthorValue ? "none" : "";
      showAuthorValue = !showAuthorValue;
    };

    const hammertime = new Hammer(document.querySelector("body"));

    hammertime.on("panup", showAuthorName);
    hammertime.on("swipeleft", fetchAndHandleQuote);
    hammertime.on("swiperight", goToPreviousWord);
    hammertime.on("doubletap", () => setRandomBgColor(bgColors));

    const nextButton = document.querySelector(".next");
    const authorTag = document.querySelector("#author");
    const loaderTag = document.querySelector("#loader");
    const qouteTag = document.querySelector("#quote");

    document
      .querySelector(".next")
      .addEventListener("click", () => fetchAndHandleQuote());

    document.addEventListener("DOMContentLoaded", () => {
      setRandomBgColor(bgColors);
      popUpMsg("‹ swipe & tap ›");
      fetchAndHandleQuote();
    });

  </script>
</body>

</html>
